(function(e){"use strict";e.fn.pickAColor=function(t){var n={white:"fff",red:"f00",orange:"f60",yellow:"ff0",green:"008000",blue:"00f",purple:"800080",black:"000"},r="ontouchstart"in window,i=parseInt(e(window).width(),10)<767?!0:!1,s="localStorage"in window&&window.localStorage!==null&&typeof JSON=="object",o=!1,u=document.cookie,a=31536e7,f=r?"touchstart.pickAColor":"mousedown.pickAColor",l=r?"touchmove.pickAColor":"mousemove.pickAColor",c=r?"touchend.pickAColor":"mouseup.pickAColor",h=r?"touchend.pickAColor":"click.pickAColor",p="dragging.pickAColor",d="endDrag.pickAColor";Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1});var v=e.extend({},{showSpectrum:!0,showSavedColors:!0,saveColorsPerElement:!1,fadeMenuToggle:!0},t),m=v.showSavedColors,g=function(){return e("<div>").addClass("input-prepend input-append pick-a-color-markup").append(e("<span>").addClass("hex-pound").text("#"))},y=function(){var t=e("<div>").addClass("btn-group").append(e("<button>").addClass("btn color-dropdown dropdown-toggle").append(e("<span>").addClass("color-preview current-color")).append(e("<span>").addClass("caret"))),r=e("<div>").addClass("color-menu dropdown-menu");!m&&!v.showSpectrum&&r.addClass("small");if(m){var i=e("<div>").addClass("color-menu-tabs");i.append(e("<span>").addClass("basicColors-tab tab tab-active").append(e("<a>").text("Basic Colors")));v.showSavedColors&&i.append(e("<span>").addClass("savedColors-tab tab").append(e("<a>").text("Your Saved Colors")));r.append(i)}var s=e("<div>").addClass("basicColors-content active-content");v.showSpectrum&&s.append(e("<h6>").addClass("color-menu-instructions").text("Tap spectrum or drag band to change color"));var u=e("<ul>").addClass("basic-colors-list");e.each(n,function(t,n){var r=e("<li>").addClass("color-item"),i=e("<a>").addClass(t+" color-link").append(e("<span>").addClass("color-preview "+t)).append(e("<span>").addClass("color-label").text(t));if(v.showSpectrum){var s=e("<span>").addClass("color-box spectrum-"+t);o&&e.each([0,1],function(r){n!=="fff"&&t!=="000"&&s.append(e("<span>").addClass(t+"-spectrum-"+r+" ie-spectrum"))});var a=e("<span>").addClass("highlight-band");e.each([0,1,2],function(){a.append(e("<span>").addClass("highlight-band-stripe"))});i.append(s.append(a))}u.append(r.append(i))});r.append(s.append(u));if(v.showSavedColors){var a=e("<div>").addClass("savedColors-content inactive-content");a.append(e("<p>").addClass("saved-colors-instructions").text("Type in a color or use the spectrums to lighten or darken an existing color."));r.append(a)}t.append(r);return t},b={},w={rowsInDropdown:8,maxColsInDropdown:2};if(v.showSavedColors){var E=[];if(s&&localStorage.allSavedColors)E=JSON.parse(localStorage.allSavedColors);else if(u.indexOf("savedColors-allSavedColors")>-1){u=u.split(";");e.each(u,function(e){u[e].match("savedColors-allSavedColors=")&&(E=u[e].split("=")[1].split(","))})}}var S={initialize:function(){var t=e(this),n=t.parents(".pick-a-color-markup");b.defaultColor=t.text()===""?"000":t.text();b.typedColor=b.defaultColor;t.html(function(){return g().append(function(){return e('<input id="appendedPrependedDropdownButton" type="text" value="'+b.defaultColor+'"/>').addClass("color-text-input")}).append(y())})},updatePreview:function(e){b.typedColor=S.rgbStringToHex(e.val());e.siblings(".btn-group").find(".current-color").css("background-color","#"+b.typedColor)},pressPreviewButton:function(e){e.stopPropagation();S.toggleDropdown(e.target)},openDropdown:function(t,n){e(".color-menu").each(function(){var t=e(this);if(t.css("display")==="block"){var n=t.parents(".btn-group");S.closeDropdown(n,t)}});v.fadeMenuToggle&&!r?e(n).fadeIn("fast"):e(n).css("display","block");e(t).addClass("open")},closeDropdown:function(t,n){v.fadeMenuToggle&&!r?e(n).fadeOut("fast"):e(n).css("display","none");e(t).removeClass("open")},toggleDropdown:function(t){var n=e(t).parents(".pick-a-color-markup"),r=n.find(".btn-group"),i=n.find(".color-menu");i.css("display")==="none"?S.openDropdown(r,i):S.closeDropdown(r,i)},tabbable:function(){var t=e(this),n=t.parents(".pick-a-color-markup");t.click(function(){var t=e(this),r=t.attr("class").split(" ")[0].split("-")[0]+"-content",i=t.parents(".dropdown-menu").find("."+r);if(!t.hasClass("tab-active")){n.find(".tab-active").removeClass("tab-active");n.find(".active-content").removeClass("active-content").addClass("inactive-content");t.addClass("tab-active");e(i).addClass("active-content").removeClass("inactive-content")}})},getColorMultiplier:function(t,n){var i=parseInt(e(".color-box").first().width(),10);i===0&&(i=r?190:200);var s=i/2,o=n/i,u;switch(t){case"fff":u="darkenRight";break;case"000":u="ligtenRight";break;default:u="bidirectional"}return u==="bidirectional"?o<=.5?(1-n/s)/2:-((n-s)/s)/2:u==="darkenRight"?-(o/2):o/2},modifyHSLLightness:function(e,t){e.l+=t;e.l=Math.min(Math.max(0,e.l),1);return tinycolor(e).toHex()},getMoveableArea:function(e){var t={},n=e.parent(),r=e.outerWidth(),i=n.width(),s=n.offset();t.minX=s.left;t.maxX=i-r;return t},moveHighlightBand:function(t,n,i){var s=e(".highlight-band").first().outerWidth(),o=s*.75,u=r?i.originalEvent.pageX:i.pageX,a=u-n.minX-o;a=Math.max(0,Math.min(a,n.maxX));t.css("position","absolute");t.css("left",a)},horizontallyDraggable:function(){e(this).on(f,function(t){t.preventDefault();var n=e(t.delegateTarget);n.css("cursor","-webkit-grabbing");n.css("cursor","-moz-grabbing");var r=S.getMoveableArea(n);e(document).on(l,function(e){n.trigger(p);S.moveHighlightBand(n,r,e)}).on(c,function(t){e(document).off(l);e(document).off(p);n.css("cursor","-webkit-grab");n.css("cursor","-moz-grab");n.one(d)})}).on(c,function(t){e(document).off(l);e(document).off(p)})},modifyHighlightBand:function(e,t,n){var r={h:0,s:0,l:.05},i={h:0,s:0,l:.5},s=-t,o=s*10,u=e.find(".highlight-band-stripe"),a=n==="000"?S.modifyHSLLightness(i,s):S.modifyHSLLightness(r,s),f=S.modifyHSLLightness(i,o);e.css("border-color","#"+a);u.css("background-color","#"+f)},calculateHighlightedColor:function(){var t=e(this),r=t.parent(),i=e(".highlight-band").first().outerWidth(),s=i/2,o=r.attr("class").split("-")[2],u=n[o],a=tinycolor(o).toHsl(),f=parseInt(t.css("left"),10)+s,l=S.getColorMultiplier(u,f),c="#"+S.modifyHSLLightness(a,l);r.siblings(".color-preview").css("background-color",c);r.prev(".color-label").replaceWith('<button class="color-select btn btn-mini" type="button">Select</button>');u!=="fff"&&S.modifyHighlightBand(t,l,u);return c},updateSavedColorPreview:function(t){e.each(t,function(n){var r=e(t[n]),i=r.attr("class");r.find(".color-preview").css("background-color",i)})},updateSavedColorMarkup:function(t,n){n=n?n:E;if(n.length>0){if(!v.saveColorsPerElement){t=e(".savedColors-content");n=E}var r=w.rowsInDropdown*w.maxColsInDropdown;n=n.slice(0,r);var i=e("<ul>").addClass("saved-color-col 0"),s=e("<ul>").addClass("saved-color-col 1");e.each(n,function(t,n){var r=e("<li>").addClass("color-item"),o=e("<a>").addClass(n);o.append(e("<span>").addClass("color-preview"));o.append(e("<span>").addClass("color-label").text(n));r.append(o);t%2===0?i.append(r):s.append(r)});t.html(i);t.append(s);var o=e(t).find("a");S.updateSavedColorPreview(o)}},setSavedColorsCookie:function(e,t){var n=new Date,r=new Date(n.getTime()+a);r=r.toGMTString();typeof t=="undefined"?document.cookie="pickAColorSavedColors-allSavedColors="+e+";expires="+r:document.cookie="pickAColorSavedColors-"+t+"="+e+";expires="+r},saveColorsToLocalStorage:function(e,t){s?typeof t=="undefined"?localStorage.allSavedColors=JSON.stringify(e):localStorage["pickAColorSavedColors-"+t]=JSON.stringify(e):S.setSavedColorsCookie(e,t)},removeFromArray:function(e,t){e.indexOf(t)!==-1&&e.splice(e.indexOf(t),1)},updateSavedColors:function(e,t,n){S.removeFromArray(t,e);t.unshift(e);S.saveColorsToLocalStorage(t,n)},addToSavedColors:function(e,t,r){if(v.showSavedColors&&!n.hasOwnProperty(e)){e.indexOf("#")===-1&&(e="#"+e);S.updateSavedColors(e,E);v.saveColorsPerElement&&S.updateSavedColors(e,t,r)}},rgbToHex:function(t){var n=[];e.each(t,function(e,t){var r=Math.floor(t).toString(16);r=r.length===1?"0"+r:r;n.push(r)});return n.join("")},rgbStringToHex:function(t){if(t.match(/^rgb/)){var n=t.split("(")[1].split(")")[0].split(",");e.each(n,function(e,t){n[e]=parseInt(t,10)});return S.rgbToHex(n)}return t},hexToRgb:function(e){e.indexOf("#")===1&&(e=e[1,e.length]);e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);var t=parseInt(e.slice(0,2),16),n=parseInt(e.slice(2,4),16),r=parseInt(e.slice(4,6),16);return[t,n,r]},bound01:function(e,t){e==="1.0"&&(e="100%");var n=typeof e=="string"&&e.indexOf("%")!=-1;e=Math.min(t,Math.max(0,parseFloat(e)));n&&(e=parseInt(e*t,10)/100);return Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)},rgbToHsl:function(e){console.log(e);var t=S.bound01(e[0],255),n=S.bound01(e[1],255),r=S.bound01(e[2],255),i=Math.max(t,n,r),s=Math.min(t,n,r),o=(i+s)/2,u=(i+s)/2,a=(i+s)/2;if(i==s)o=u=0;else{var f=i-s;u=a>.5?f/(2-i-s):f/(i+s);switch(i){case t:o=(n-r)/f+(n<r?6:0);break;case n:o=(r-t)/f+2;break;case r:o=(t-n)/f+4}o/=6;console.log(o)}console.log({h:o,s:u,l:a});return{h:o,s:u,l:a}},hslToRgb:function(e){function u(e,t,n){n<0&&(n+=1);n>1&&(n-=1);return n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var t,n,r,i=S.bound01(e.h,360),s=S.bound01(e.s,100),o=S.bound01(e.l,100);if(s===0)t=n=r=o;else{var a=o<.5?o*(1+s):o+s-o*s,f=2*o-a;t=u(f,a,i+1/3);n=u(f,a,i);r=u(f,a,i-1/3)}return[t*25500,n*25500,r*25500]},hexToHsl:function(e){return S.rgbToHsl(S.hexToRgb(e))},hslToHex:function(e){return S.rgbToHex(S.hslToRgb(e))}};return this.each(function(){S.initialize.apply(this);var t=this,n=e(t).find("input"),r=e(t).find(".color-menu li a"),i=e(t).find(".btn-group"),o=e(t).find(".color-menu"),a=e(t).find(".color-box"),f=e(t).find(".color-menu-instructions"),l=e(t).find(".highlight-band");if(m)var c=e(t).find(".tab");if(v.showSavedColors){var g=e(t).find(".savedColors-content");if(v.saveColorsPerElement){var y=[],w=e(t).data(),x;e.each(w,function(e){x=e});if(s&&localStorage["pickAColorSavedColors-"+x])y=JSON.parse(localStorage["pickAColorSavedColors-"+x]);else if(u.indexOf("pickAColorSavedColors-"+x)>-1){u=u.split(";");e.each(u,function(e){if(u[e]="pickAColorSavedColors"+x)y=u[e].split("=")[1].split(",")})}else y=E}}S.addToSavedColors(b.defaultColor,y,x);S.updatePreview(n);n.focus(function(){var t=e(this);b.typedColor=t.val();t.val("");S.openDropdown(i,o)}).blur(function(){var t=e(this);setTimeout(function(){S.closeDropdown(i,o)},250);b.newValue=t.val();if(b.newValue.match(/^\s+$|^$/))t.val(b.typedColor);else{b.newValue=S.rgbStringToHex(b.newValue);t.val(b.newValue);S.addToSavedColors(b.newValue,y,x);S.updateSavedColorMarkup(g,y)}S.updatePreview(t)});i.on(h,function(e){S.pressPreviewButton(e)});e(document).on(h,function(){o.css("display")==="block"&&S.closeDropdown(i,o)});o.on(h,function(e){e.stopPropagation()});n.on(h,function(e){e.stopPropagation()});r.click(function(){var t=e(this).find("span:first").css("background-color");t=S.rgbStringToHex(t);e(n).val(t);S.updatePreview(n);S.addToSavedColors(t,y,x);S.updateSavedColorMarkup(g,y);S.closeDropdown(i,o)});m&&S.tabbable.apply(c);if(v.showSpectrum){e(this).find(".color-box").click(function(t){console.log("click");t.stopPropagation();var n=e(this),r=n.find(".highlight-band"),i=S.getMoveableArea(r);S.moveHighlightBand(r,i,t);var s=S.calculateHighlightedColor.apply(r);S.addToSavedColors(s,y,x);S.updateSavedColorMarkup(g,y);f.html("Press 'select' to choose this color.")});S.horizontallyDraggable.apply(l);e(l).on(p,function(e){var t=e.target;S.calculateHighlightedColor.apply(this)}).on(d,function(e){console.log("endDrag");var t=e.delegateTarget,n=S.calculateHighlightedColor.apply(t);S.addToSavedColors(n,y,x);S.updateSavedColorMarkup(g,y)})}if(v.showSavedColors){e(g).click(function(t){var r=e(t.target);if(r.is("SPAN")||r.is("A")){var s=r.is("SPAN")?r.parent().attr("class").split("#")[1]:r.attr("class").split("#")[1];e(n).val(s);S.updatePyreview(n);S.closeDropdown(i,o);S.addToSavedColors(s,y,x);S.updateSavedColorMarkup(g,y)}});v.saveColorsPerElement?v.saveColorsPerElement&&S.updateSavedColorMarkup(g,y):S.updateSavedColorMarkup(g,E)}})}})(jQuery);